<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Meta tags for character set and responsive design -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- External resources -->
    <!-- Bootstrap CSS for responsive components -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    
    <!-- Google Fonts for typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100..900&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">
    
    <!-- Custom stylesheet -->
    <link rel="stylesheet" href="stylesheet/stylesheet.css">
    <title>To Do List</title>
</head>

<body>
    <!-- Main container -->
    <div class="container">
        <!-- Header section -->
        <div class="header">
            <h2>Today</h2>
        </div>

        <!-- Loop through each todo item -->
        <% items.forEach(item=> { %>
            <div class="task">
                <!-- DELETE Form - auto-submits when checkbox changes -->
                <form action="/delete" method="post">
                    <input type="checkbox" 
                           onchange="this.form.submit()" 
                           name="deleteTaskId" 
                           value="<%= item.id %>"
                           class="checkbox">
                </form>
                
                <!-- Display task text -->
                <p class="title">
                    <%= item.item %>
                </p>

                <!-- EDIT Form - handles task updates -->
                <form action="/edit" method="post" class="edit-form">
                    <!-- Hidden field to store item ID -->
                    <input type="hidden" name="updatedItemId" value="<%= item.id %>">
                    
                    <!-- Editable text field (hidden by default) -->
                    <input type="text" 
                           value="<%= item.item %>" 
                           name="updatedItemTitle" 
                           class="edit-input"
                           autocomplete="off" 
                           hidden 
                           required> <!-- Prevents empty submissions -->
                    
                    <!-- Save button (hidden by default) -->
                    <button type="submit" class="done-btn" hidden>
                        <img src="assets/icons/check-solid.svg" alt="Save" class="icon">
                    </button>
                    
                    <!-- Edit button - triggers edit mode -->
                    <button type="button" class="edit-btn" onclick="handler(this)">
                        <img src="assets/icons/pencil-solid.svg" alt="Edit" class="icon">
                    </button>
                </form>
            </div>
        <% }); %>

        <!-- ADD Form - creates new items -->
        <form class="item" action="/add" method="post">
            <input type="text" name="newItem" placeholder="New Item" autocomplete="off" autofocus="true">
            <button class="add" type="submit" name="list" value="">+</button>
        </form>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
        crossorigin="anonymous"></script>

    <!-- Custom JavaScript -->
    <script>
        // Edit mode handler function
        function handler(button) {
            // 1. Find closest task container
            const task = button.closest('.task');
            
            // 2. Get elements within this task
            const title = task.querySelector('.title');
            const editInput = task.querySelector('.edit-input');
            const doneBtn = task.querySelector('.done-btn');
            const editBtn = task.querySelector('.edit-btn');
            
            // 3. Toggle visibility:
            title.hidden = true;        // Hide static text
            editBtn.hidden = true;      // Hide edit button
            doneBtn.hidden = false;     // Show save button
            editInput.hidden = false;   // Show editable input
            
            // 4. Focus on input for editing
            editInput.focus();
        }
    </script>
</body>
</html>