pipeline {
  agent any
  environment {
    APP_NAME = "todo-app"
    IMAGE_NAME = "yourdockerhubusername/todo-app"
    IMAGE_TAG = "${env.BUILD_NUMBER}"
  }
  stages {
    stage('Build') {
      steps {
        bat "docker build -t %IMAGE_NAME%:%IMAGE_TAG% ."
      }
    }
    stage('Test') {
      steps {
        bat "npm install"
        // if no tests exist yet, allow it to pass
        bat "npm test || exit 0"
      }
    }
    stage('Security') {
        steps {
            bat 'echo "Security scan placeholder - Trivy not installed"'
        }
    }
    stage('Deploy') {
        steps {
            bat 'docker run -d -p 3000:3000 --name todo-app yourdockerhubusername/todo-app:8 || exit 0'
        }
    }

  }
}
